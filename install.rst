############################
スクリプトの設定
############################

**スクリプトプロジェクトの設定** ～ **VRMViewMeisterに設定する** までを、Googleスライドで解説しています。

`vrmviewmeister-gdrive-extension Install manual <https://docs.google.com/presentation/d/e/2PACX-1vQP2RstLGn82dh_FOqBfbPPBGvx9o-YQXc-3ol8Gk4_IseKrzsgs0hgAt0h4uYX2kA71ENrnI-XXbBf/pub?start=false&loop=false&delayms=3000>`__

私のGoogleドライブのフォルダにあらかじめスクリプトを用意しています。コピーしてお使いください。
 `share/extensions <https://drive.google.com/drive/folders/1QkWCH0GfKHIQLgbT5Ir-U-mBEKAE3AJy?usp=drive_link>`__


スクリプトプロジェクトの作成
############################

素早く使いたい場合は共有されたスクリプトをコピーすることをお勧めします。

自分で本リポジトリからセットアップする場合は下記の手順を参考にしてください。

1. 自分のGoogleドライブを開きます。
2. 新規ボタンからGoogleAppsScriptを選びます。
3. スクリプトエディタが開きます。
4. プロジェクト名は適当につけます。
5. デフォルトのソースコードを削除し、本リポジトリの ``apiget.js`` の内容をコピーして貼り付けます。
6. エディタ中のファイル一覧の右上の ``+`` ボタンからスクリプトを追加します。
7. ファイル名は ``apipost.gs`` などとします。
8. 本リポジトリの ``apipost.js`` の内容をコピーして貼り付けます。


APIに自分のアカウントを許可する
#################################

このプロジェクトは自分だけが使用するものですが、スクリプトが自分のGoogleアカウントにアクセスできるように許可を与える必要があります。

1. ``apiget.js`` の内容を貼り付けたスクリプトを選択します。
2. エディタのツールバーの ``実行する関数を選択`` から ``setupTest`` を選択します。
3. 実行ボタンをクリックします。
4. ``承認が必要です`` のメッセージが表示されたら ``権限を確認`` をクリックします。
5. ログインのポップアップウィンドウで自分のアカウントを選択します。
6. ``このアプリはGoogleで確認されていません`` が表示されたら、ページ下の ``[スクリプト名]に移動`` のリンクをクリックします。
7. アクセスのリクエストの内容が表示されます。
8. 一番下までスクロールし、``許可`` ボタンをクリックします。
9. テストコードが実行され、自分のドライブの使用状況がログに表示されます。

これで実際のウェブアプリの設定が完了しました。

.. warning::
   * スクリプトの内容は本リポジトリで公開のものであることを確認して手順を進めてください。
   * 自分自身が作成（貼り付け）したスクリプトなのでGoogleが確認していなくても問題ありません。手順を進めて構いません。

APIKEYの入力
#############################

本スクリプトの機能をVRMViewMeisterから使うにはAPIKEYの設定を必要とします。これはGoogleの公式なものではなく、あくまでもVRMViewMeisterとしての単なる決まり事です。

ここで **APIKEY** という形で自分しか知らない文字列を決めることで、万が一ウェブアプリのURLが流出したときでも、勝手に実行されないようセキュリティを高めることができます。

1. スクリプトプロジェクトの作成まで進めます。
2. 左の縦のツールバーにある ``プロジェクトの設定`` をクリックします。
3. 表示されたページの一番下にある ``スクリプトプロパティを編集`` ボタンをクリックします。
4. ``スクリプトプロパティを追加`` ボタンをクリックします。
5. 入力欄が表示されたら、プロパティに ``APIKEY`` と入力します。
6. 値には自分で好きな文字列を決めて入力します。
7. ``スクリプトプロパティを保存`` をクリックします。



デプロイ
#############################

GoogleAppsScriptをウェブアプリとして公開する手順です。

1. エディタ画面右上の ``デプロイ`` ボタンをクリックします。
2. ``新しいデプロイ`` をクリックします。
3. 歯車ボタンの ``デプロイタイプを有効にする`` から、``ウェブアプリ`` を選択します。
4. ``説明`` には適当に文章を入力します。
5. ``次のユーザーとして実行`` を ``自分`` にします。
6. ``アクセスできるユーザー`` を ``全員`` にします。
7. ``デプロイ`` ボタンをクリックします。

これでウェブアプリのURLが発行されます。

VRMViewMeisterに設定する
################################

1. VRMViewMeisterを起動します
2. リボンバーのHomeタブにある ``設定`` をクリックします
3. 設定ウィンドウの ``File loader`` タブをクリックします
4. URLとAPIKEYそれぞれを入力します。

これでVRMViewMeisterが指定のURLからデータを読み書きできるようになります。

VRMViewMeisterでGoogleドライブを使わない場合はこの設定欄を空欄にしてください。それだけでまずはユーザーのGoogleドライブへのアクセスを遮断することができます。

スクリプトをアップデートする
##################################

スクリプトを更新する場合は本リポジトリまたは上記GoogleAppsScriptのスクリプトプロジェクトを開き、ソースだけをまるごとコピーしてください。

本リポジトリを使う場合
=================================

1. 自分のドライブにあるGoogleAppsScriptプロジェクトを開く
2. **apiget.js** の内容をすべてコピーする
3. **apiget.gs** に上書きする
4. **apipost.js** の内容をすべてコピーする
5. **apipost.gs** に上書きする
6. スクリプトプロジェクトを保存する

開発者のドライブにあるオリジナルを使う場合
=============================================

1. `share/extensions <https://drive.google.com/drive/folders/1QkWCH0GfKHIQLgbT5Ir-U-mBEKAE3AJy?usp=drive_link>`__ にある ``vrmviewmeister-gdrive-extension`` を開く。
2. 自分のドライブにあるGoogleAppsScriptプロジェクトを開く
3. **apiget.gs** の内容をすべてコピーする
4. 自分のスクリプトプロジェクトの **apiget.gs** に上書きする
5. **apipost.gs** の内容をすべてコピーする
6. 自分のスクリプトプロジェクトの **apipost.gs** に上書きする
7. スクリプトプロジェクトを保存する

次の作業
===========================================

1. 自分のスクリプトプロジェクトを開きます。
2. エディタのツールバーの ``実行する関数を選択`` から ``setupTest`` を選択します。
3. 実行してください。
4. 参照するサービスの増減がなければ、すぐにスクリプトの実行が完了して結果が表示されます。
5. ``デプロイ`` と ``VRMViewMeisterに設定する`` の手順をしてください。

.. note::
   スクリプトの権限が追加になる場合、アップデート公開時にご案内します。

.. caution::
   以前のデプロイで発行したURLは使わなくなります。下記の手順で停止してください。



発行したURLを停止する
#############################

もしVRMViewMeisterでGoogleドライブを参照しなくなった、その他不安なので使いたくない場合は下記手順で停止することができます。

1. エディタ画面右上の ``デプロイ`` ボタンをクリックします。
2. ``デプロイの管理`` をクリックします。
3. 停止したバージョンをクリックして選択します。
4. 右上の ``デプロイメントをアーカイブ`` をクリックします。
5. 確認のメッセージが表示されるので、右下の ``アーカイブ`` ボタンをクリックします。

すると、対象のバージョンのウェブアプリのURLが無効化されます。

.. hint::
    完全に停止・削除するには最後にスクリプトプロジェクトをまるごと削除することをおすすめします。

